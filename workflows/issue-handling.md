# Issue対応ワークフロー

## 基本原則

「issue #nnを対応してください」と指示された場合の完全自動化フロー

### Issue対応の品質管理基準
- **再現性の確保**: 問題の再現手順を必ず確認・検証
- **影響範囲の評価**: 変更による既存機能への影響を事前評価
- **テストカバレッジ**: 新機能・修正には対応するテストを必ず追加
- **ドキュメント整合性**: 仕様変更時は関連ドキュメントも更新
- **セキュリティ配慮**: セキュリティに関わる変更は特に慎重に検証

## Issue対応の完全フロー

### 1. **Issue内容確認・分析**

Claude Codeが以下を自動実行：
- Issue詳細の取得・分析（タイトル、本文、ラベル、関連Issue）
- 優先度判定（critical/urgent → 高、enhancement/feature → 中、その他 → 低）
- 複雑度評価（本文長、関連Issue数、技術的要件から判定）
- 依存関係検出（関連Issue、ブロッカーの確認）

#### Issue内容の理解・検証項目
- **問題の概要**: 何が問題なのか、なぜ重要なのか
- **再現手順**: 具体的な手順、環境情報
- **期待される動作**: 修正後の理想的な状態
- **技術的要件**: 使用技術、制約条件、パフォーマンス要求
- **受け入れ基準**: 完了判定の明確な基準

### 2. **ブランチ作成**

Claude Codeが以下を自動実行：
- upstream/origin判定とメインブランチ取得
- Issueタイトルから適切なタイプを判定（fix/feat/docs/test/refactor）
- Conventional Commits形式のブランチ名生成
- no-track設定でブランチ作成・切り替え

例: `git checkout -b fix/login-validation --no-track upstream/main`

### 3. **実装計画・実行**

#### **実装前の準備**
Claude Codeによる影響範囲調査：
- 関連ファイルの特定（エラー箇所、類似機能、依存関係）
- 既存テストの確認
- 変更に必要なファイル群の把握

#### **段階的実装アプローチ**
複雑度に応じた実装戦略：
- **シンプル**: 直接実装
- **中程度**: 最小実装 → テスト追加 → 機能拡張
- **複雑**: 設計検討 → プロトタイプ → 段階的実装 → 統合テスト

#### **実装種別ごとの対応**

##### **バグ修正 (fix)**
1. 問題の再現
2. 原因の特定
3. 最小限の修正
4. 回帰テストの追加
5. 副作用の確認

##### **新機能 (feat)**
1. 要件の詳細確認
2. 設計の検討
3. インターフェース定義
4. 実装
5. ユニットテスト
6. 統合テスト
7. ドキュメント更新

##### **リファクタリング (refactor)**
1. 現在の動作確認
2. リファクタリング対象の特定
3. 段階的な改善
4. テストでの動作確認
5. パフォーマンス測定

##### **ドキュメント (docs)**
1. 対象ドキュメントの特定
2. 現在の内容確認
3. 不足・誤りの特定
4. 内容の更新・追加
5. リンク整合性確認

##### **テスト (test)**
1. テスト対象の特定
2. テストケース設計
3. 正常系テスト
4. 異常系テスト
5. 境界値テスト
6. カバレッジ確認

### 4. **品質チェック・検証**

#### **基本品質チェック**
Claude Codeが以下を自動実行：
- パッケージマネージャー自動判定（pnpm/yarn/bun/npm）
- Lint検査の実行
- 型チェック（TypeScript）の実行
- テスト実行
- ビルド確認

#### **拡張品質チェック**
条件に応じた追加検証：
- **セキュリティチェック**: 高優先度・security関連Issue向け
- **パフォーマンステスト**: performance関連Issue向け
- **テストカバレッジ**: 新機能・重要な修正向け

#### **Issue種別ごとの追加検証**
- **fix**: 問題再現確認 → 修正後動作確認 → 回帰テスト → 関連機能確認
- **feat**: 機能要件充足 → ユーザビリティ → 既存機能統合 → ドキュメント整合性
- **refactor**: 既存機能動作 → パフォーマンス比較 → コード品質 → API互換性
- **docs**: 内容正確性 → リンク有効性 → 形式統一性 → 実装整合性
- **test**: ケース網羅性 → 実行時間 → 安定性 → カバレッジ向上

### 5. **コミット・プッシュ**

Claude Codeが以下を自動実行：
- 変更のステージング
- Conventional Commits形式でのコミット作成
- Issue番号の自動連携（Fixes #nn）
- リモートブランチへのプッシュ

### 6. **PR作成**

Claude Codeが以下を自動実行：
- Conventional Commits形式のPRタイトル設定
- 日本語でのPR本文作成（概要、変更内容、テスト内容、チェックリスト）
- Issue自動クローズ設定（Closes #nn）
- PR作成とURL返却

## エスカレーション・継続戦略

### **エスカレーション基準**
- 複雑度が高く実装時間が4時間以上見込まれる場合
- 高優先度で複数の依存関係がある場合
- セキュリティ・パフォーマンスへの重大な影響が予想される場合

### **エスカレーション実行**
Claude Codeによる自動対応：
- Issue へのエスカレーション通知コメント追加
- 「escalated」「needs-review」ラベルの追加
- 現在の分析状況と必要なアクションの明記

### **メトリクス追跡**
各Issue対応完了時にClaude Codeが記録：
- 対応時間（開始〜完了）
- 複雑度・優先度
- 品質指標（lint/test結果、変更ファイル数）
- Issue完了コメントとしてメトリクス記録

### **継続的改善**
PR完了後のClaude Codeによる自動評価：
- PR品質スコア（変更行数、ファイル数、コミット数）
- 改善提案の生成
- 学習ポイントの記録

## 手動実行が必要な場合

Claude Codeを使用せず手動でIssue対応を行う特殊なケース向け：

### 手動Issue対応の基本コマンド

```bash
#!/bin/bash
# manual_issue_handling.sh - 手動Issue対応スクリプト

ISSUE_NUMBER=$1
if [ -z "$ISSUE_NUMBER" ]; then
    echo "Usage: $0 <issue_number>"
    exit 1
fi

# Issue確認
gh issue view $ISSUE_NUMBER

# ブランチ作成（手動でタイプ・説明を指定）
ISSUE_TITLE=$(gh issue view $ISSUE_NUMBER --json title -q '.title')
# タイプは手動判定: fix/feat/docs/test/refactor
TYPE="fix"  # 適切に変更
DESCRIPTION="manual-fix"  # 適切に変更
git checkout -b $TYPE/$DESCRIPTION --no-track origin/main

echo "手動実装を開始してください"
echo "完了後、以下を実行："
echo "  git add ."
echo "  git commit -m \"$TYPE: $ISSUE_TITLE\""
echo "  git push -u origin $TYPE/$DESCRIPTION"
echo "  gh pr create --title \"$TYPE: $ISSUE_TITLE\" --body \"Closes #$ISSUE_NUMBER\""
```

### 使用場面
- Claude Codeでは対応困難な特殊な技術要件
- 外部システムとの連携が必要な場合
- 手動での詳細な調査・検証が必要な場合

この完全自動化により、「issue #nnを対応してください」と指示するだけで、Issue確認からPR作成まで一貫した高品質な対応が実現されます。