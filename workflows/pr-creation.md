# プルリクエスト作成・更新指針

## 基本原則

- **Issue連携**: 関連するIssueを自動クローズするキーワードを使用
- **日本語本文**: PR本文は日本語で記述
- **Conventional Commits**: タイトルはマージ時のコミットメッセージとして適切な形式
- **継続的更新**: PR本文は実装内容の変更に応じて適宜更新

## Claude Codeによる自動PR作成

### **基本フロー**
Claude Codeが以下を自動実行：
1. Conventional Commits形式のタイトル生成（Issue内容から判定）
2. 日本語でのPR本文作成（概要、変更内容、テスト内容、チェックリスト）
3. Issue自動クローズ設定（Closes #nn）
4. PR作成とURL返却

### **タイトル生成ルール**
Issue内容から以下の形式で自動生成：
- **feat**: 新機能追加
- **fix**: バグ修正
- **docs**: ドキュメント変更
- **refactor**: リファクタリング
- **test**: テスト追加・修正
- **style**: コードスタイル修正
- **perf**: パフォーマンス改善

例: `feat: ユーザー認証機能を追加`, `fix: パスワードバリデーションのバグを修正`

### **PR本文構造**
```markdown
## 概要
Issue #nn の対応: [Issue内容の要約]

## 変更内容
- [実装された機能・修正内容]
- [影響範囲の説明]
- [技術的な詳細]

## テスト内容
- [実施したテストの内容]
- [確認した動作]
- [新規テストの追加]

## チェックリスト
- [x] ローカルでlint/testが通ることを確認
- [x] 既存機能に影響がないことを確認
- [x] Issue要件を満たしていることを確認

Closes #nn
```

## PR本文・タイトルの継続的更新

### **Claude Codeによる自動更新**
以下のタイミングで自動更新：
- 新しいコミット追加時
- レビュー指摘対応時
- テスト結果に応じた修正時
- スコープ変更時
- 設計変更時

### **更新内容**
Claude Codeが以下を自動反映：
- 新しい変更内容の追記
- レビュー対応履歴の記録
- テスト内容・結果の更新
- 更新履歴の自動追加

### **更新タイミングの判断基準**

#### **必須更新ケース**
- 実装方針の大幅変更
- 新しい機能・修正の追加
- 重要なバグ修正の追加
- セキュリティ関連の変更
- パフォーマンス影響の変更

#### **推奨更新ケース**
- レビュー指摘事項の対応
- テストケースの追加・修正
- ドキュメント更新の追加
- リファクタリングの追加

#### **更新不要ケース**
- 軽微なタイポ修正
- コメントの追加・修正のみ
- インデント・フォーマット修正のみ

### **効率的な更新戦略**
- **段階的更新**: 初期→レビュー後→追加実装後→最終整理
- **履歴の保持**: 変更日時と理由の記録
- **実装説明の強化**: 当初の実装から最終実装への経緯

## Issue連携・管理

### **自動クローズキーワード**
Claude Codeが以下を自動設定：
- `Closes #123` - 一般的なクローズ
- `Fixes #123` - バグ修正
- `Resolves #123` - 課題解決

### **複数Issue対応**
```markdown
Closes #123
Closes #124
Closes #125
```

### **Draft PR対応**
作業中・段階的実装の場合：
- Draft状態でPR作成
- 進捗状況をチェックリスト形式で管理
- 完了時にReady for Reviewに変更

## 手動PR作成が必要な場合

Claude Codeを使用せず手動でPR作成を行う特殊ケース向け：

### 手動PR作成の基本コマンド

```bash
#!/bin/bash
# manual_pr_creation.sh - 手動PR作成スクリプト

ISSUE_NUMBER=$1
TYPE=${2:-"feat"}
TITLE=${3:-"Issue対応"}

if [ -z "$ISSUE_NUMBER" ]; then
    echo "Usage: $0 <issue_number> [type] [title]"
    echo "Example: $0 123 feat '新機能追加'"
    exit 1
fi

# Issue情報取得
ISSUE_TITLE=$(gh issue view $ISSUE_NUMBER --json title -q '.title')

# PR作成
gh pr create \
  --title "$TYPE: $TITLE" \
  --body "## 概要
Issue #$ISSUE_NUMBER の対応

$ISSUE_TITLE

## 変更内容
- 手動で記載してください

## テスト内容
- 手動で記載してください

## チェックリスト
- [ ] ローカルでlint/testが通ることを確認
- [ ] 既存機能に影響がないことを確認
- [ ] Issue要件を満たしていることを確認

Closes #$ISSUE_NUMBER"

echo "✅ PR作成完了"
echo "PR本文は必要に応じて手動で更新してください"
```

### 使用場面
- 複雑なPR本文構成が必要な場合
- 特殊なテンプレート・フォーマットが必要な場合
- 段階的なPR作成プロセスが必要な場合

## 注意事項

### **タイトルの重要性**
- マージ時のコミットメッセージになる
- プロジェクト履歴の可読性に影響
- 自動化ツールでの解析に使用
- スコープが大幅に変更された場合は必ずタイトルも更新

### **Issue連携の効果**
- Issue自動クローズ
- 変更履歴の追跡性向上
- プロジェクト管理の効率化

### **継続的更新の重要性**
- レビュアーが最新の実装内容を正確に把握
- 将来の参照時に実際の実装と一致した情報
- プロジェクト管理の精度向上
- ドキュメントとしての価値向上

この自動化により、Issue対応完了時に適切なPRが自動作成され、実装の変更に応じて継続的に更新されます。