## 言語

- 最終的なユーザへの回答は日本語で行なってください。途中経過は、コンテキスト削減のため主要・重要なところ以外は英語で説明します。
- コード内のコメントは、日本語で記載してください。エラーメッセージなどは、原則英語で記載します。

## 環境のルール

- Git コミットの作成時は、[Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/) に従わなければなりません。ただし、`<description>` は日本語で記載します。
- ブランチを作成するときは、[Conventional Branch](https://conventional-branch.github.io) に従わなければなりません。ただし、`<type>` は短縮形 (feat, fix) で記載します。
- GitHub リポジトリを調査のために参照する場合、テンポラリディレクトリに git clone して、そこでコード検索してください。
- Windows 環境ですが、Git Bash で動作しています。bash コマンドを使用してください。PowerShell コマンドを使用する場合は、明示的に `powershell -Command ...` か `pwsh -Command ...` を使用してください。
- CLAUDE.md の内容は適宜更新しなければなりません。
- このプロジェクトでは Serena が使用できます。
- Renovate が作成した既存のプルリクエストに対して、追加コミットや更新を行ってはなりません。

## Git Worktree について

プロジェクトによっては、Git Worktree を採用している場合があります。

Git Worktree のディレクトリ構成は、以下でなければなりません。  
新規ブランチを作成する場合は、ブランチ作成後に Git Worktree を新規作成してください。

```text
.bare/
<ブランチ名>
```

例は以下の通りです。

```text
.bare/              # bare リポジトリ（隠しディレクトリ）
master/             # master ブランチの worktree
develop/            # develop ブランチの worktree
feature/
  x/                # feature/x ブランチの worktree
```

## Claude in Chrome について

- Claude in Chrome を操作する際は、座標ではなくセレクターによって要素を特定すること
- プロジェクトの実装と比較し、ページに更新が入っていたりする場合は正しい操作を確認したうえで、実装を改善すること

## コード改修時のルール

- 日本語と英数字の間には、半角スペースを挿入しなければなりません
- 既存のエラーメッセージで、先頭に絵文字がある場合は、全体でエラーメッセージに絵文字を設定してください。絵文字はエラーメッセージに即した一文字の絵文字である必要があります。
- TypeScript プロジェクトにおいて、skipLibCheckを有効にして回避することは絶対にしてはなりません

## 必ず実施すること

以下の内容については、Todo ツールを使用し、漏らさずすべてを実施してください。

### 新規改修時

新規改修を行う前に、以下を必ず確認しなければなりません

1. プロジェクトについて詳細に探索し理解すること
2. 作業を行うブランチが適切であること。すでに PR を提出しクローズされたブランチでないこと
3. 最新のリモートブランチに基づいた新規ブランチであること
4. PR がクローズされ、不要となったブランチは削除されていること
5. プロジェクトで指定されたパッケージマネージャにより、依存パッケージをインストールしたこと

### コミット・プッシュする前

コミット・プッシュする前に、以下を必ず確認しなければなりません

1. コミットメッセージが [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/) に従っていること。ただし、`<description>` は日本語で記載します。
2. コミット内容にセンシティブな情報が含まれていないこと
3. Lint / Format エラーが発生しないこと
4. 動作確認を行い、期待通り動作すること

### プルリクエストを作成する前

プルリクエストを作成する前に、以下を必ず確認しなければなりません

1. プルリクエストの作成をユーザーから依頼されていること
2. コミット内容にセンシティブな情報が含まれていないこと
3. コンフリクトする恐れが無いこと

### プルリクエストを作成したあと

プルリクエストを作成したあとは、以下を必ず実施しなければなりません。PR 作成後のプッシュ時に毎回実施してください。
時間がかかる処理が多いため、Task を使って並列実行してください。

1. コンフリクトが発生していないこと
2. PR本文の内容は、ブランチの現在の状態を、今までのこのPRでの更新履歴を含むことなく、最新の状態のみ、漏れなく日本語で記載されていること。このPRを見たユーザーが、最終的にどのような変更を含むPRなのかをわかりやすく、細かく記載されていること
3. **PR 本文と実装の整合性を検証すること**。`git diff` で実際のコード変更を確認し、PR 本文に記載された内容（デフォルト値、環境変数名、セレクター、タイムアウト値など）が実装と一致していることを確認すること。不一致がある場合は PR 本文を更新すること
4. `gh pr checks <PR ID> --watch` で GitHub Actions CI を待ち、その結果がエラーとなっていないこと。成功している場合でも、ログを確認し、誤って成功扱いになっていないこと。もし GitHub Actions が動作しない場合は、ローカルで CI と同等のテストを行い、CI が成功することを保証しなければなりません。
5. 10分以内に投稿される GitHub Copilot レビューへの対応を行うこと。対応したら、レビューコメントそれぞれに対して返信を行うこと
6. `/code-review:code-review` によるコードレビューを実施したこと。コードレビュー内容に対しては、信頼度スコアが 50 以上の指摘事項に対して対応してください

@CLAUDE.local.md
