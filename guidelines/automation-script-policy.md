# 自動化スクリプト記述ガイドライン

## 基本方針

### 問題の認識
- **Claude誤実行リスク**: 指示文中のスクリプトをClaude Codeが実行しようとする
- **入力待ち問題**: `read`コマンドなどでフリーズする可能性
- **予期しない動作**: 意図しないファイル操作やシステム変更

### 解決アプローチ
- **説明用スクリプト**: 実行しない前提で概念・手順を説明
- **実装用スクリプト**: 実際に作成・実行するための具体的なスクリプト
- **明確な区別**: どちらの用途かを文脈で明示

## スクリプト記述の分類

### 1. **説明用スクリプト（非実行）**

**用途**: 概念説明、手順理解、参考例示
**記述方法**: 

```markdown
# 概念説明例
```bash
# このスクリプトは説明用です - 実行されません
if [[ $CONDITION == "example" ]]; then
    echo "このような処理が行われる"
fi
```
```

**特徴**:
- コメントで明示的に「説明用」と記載
- 変数名は抽象的・汎用的（`$CONDITION`, `{VARIABLE}`など）
- 実際の値は使用しない

### 2. **実装用スクリプト（実行対象）**

**用途**: 実際にファイル作成・実行する具体的なスクリプト
**記述方法**:

```markdown
実際に以下のスクリプトを作成します：

```bash
#!/bin/bash
# handle_issue.sh - 実際のIssue対応スクリプト

ISSUE_NUMBER=$1
echo "Issue #$ISSUE_NUMBER を処理中..."
```
```

**特徴**:
- 具体的なファイル名・パスを指定
- 実行可能な完全なスクリプト
- 「作成します」「実行します」など明確な実行意図

### 3. **テンプレートスクリプト（要調整）**

**用途**: プロジェクト固有に調整が必要なひな形
**記述方法**:

```markdown
以下をベースに、プロジェクトに応じて調整してください：

```bash
# プロジェクト固有の設定
PROJECT_NAME="your-project"  # 要変更
MAIN_BRANCH="main"           # 要確認

# 共通処理
git checkout -b feature/$PROJECT_NAME
```
```

## Claude Code実行回避策

### 1. **スクリプトブロックの安全化**

#### **危険な記述（避ける）**
```markdown
```bash
read -r input
rm -rf /tmp/data
curl -X POST api.example.com
```
```

#### **安全な記述（推奨）**
```markdown
```bash
# 説明用 - 実行されません
read -r input     # ユーザー入力を待機
rm -rf /tmp/data  # 一時データを削除
curl -X POST api.example.com  # APIに送信
```
```

### 2. **インタラクティブ要素の回避**

#### **避けるべきコマンド**
- `read`: 入力待ちでフリーズ
- `select`: メニュー選択待ち
- `vim`, `nano`: エディタ起動
- `less`, `more`: ページャー起動
- 確認プロンプト付きコマンド（`rm -i`, `cp -i`）

#### **代替表現方法**
```bash
# ❌ 危険（フリーズリスク）
echo "選択してください:"
select choice in "A" "B"; do
    break
done

# ✅ 安全（説明用）
# このスクリプトでは以下の選択肢から入力を受け取る：
# 1) A - オプションA
# 2) B - オプションB
CHOICE="A"  # 例: ユーザーがAを選択した場合
```

### 3. **破壊的操作の明示**

```bash
# ⚠️ 注意: このコマンドはファイルを削除します
# 実行前に必ずバックアップを取ってください
rm important_file.txt

# 💡 より安全な表現
echo "important_file.txt を削除する場合："
echo "rm important_file.txt"
```

## ドキュメント記述のベストプラクティス

### 1. **意図の明確化**

```markdown
# ✅ 良い例
以下は概念的な処理フローです（実行用ではありません）：

# ❌ 悪い例  
以下のスクリプトを使用します：
```

### 2. **実行コンテキストの指定**

```markdown
# プロジェクトルートで実行する場合：
cd /path/to/project
npm install

# または、作業ディレクトリを明示：
# 注意: このコマンドは ~/my-project ディレクトリで実行してください
```

### 3. **段階的な説明**

```markdown
## 手順概要
1. 環境変数の設定
2. 依存関係のインストール  
3. 設定ファイルの生成
4. サービスの起動

## 詳細手順
各ステップの具体的なコマンド：

### 1. 環境変数の設定
```bash
export API_KEY="your-key-here"
export DEBUG_MODE="true"
```
```

## ファイル種別ごとの対応

### 1. **ワークフロー定義ファイル**
- 主に説明用スクリプトを使用
- 実行意図がある場合は明確に区別
- テンプレート性質のものは調整要否を明記

### 2. **ツール使用指針**
- 具体的なコマンド例は実行想定
- 汎用的な説明は非実行想定
- プロジェクト固有の部分は要調整として記載

### 3. **プロジェクト固有設定**
- 実際の環境に合わせた実行可能スクリプト
- 即座に実行できる完全な形式
- 環境固有の値は明確に識別

## 実装における注意点

### 1. **Claude Codeへの配慮**
- 入力待ちコマンドの絶対的回避
- 破壊的操作の慎重な扱い
- 明確なコンテキスト指定

### 2. **保守性の確保**
- スクリプトの用途を明確に文書化
- 実行環境・前提条件の明記
- エラー時の対処法の併記

### 3. **セキュリティ配慮**
- 認証情報のハードコード回避
- 権限昇格コマンドの注意喚起
- 外部サービスへの接続時の確認促進

## 実際の適用例

### 現在の改善対象

#### **修正前（問題のある記述）**
```bash
#!/bin/bash
echo "Issue番号を入力してください:"
read -r ISSUE_NUMBER
gh issue view $ISSUE_NUMBER
```

#### **修正後（安全な記述）**
```bash
#!/bin/bash
# Issue対応スクリプト - 実際に作成・実行する場合の例

ISSUE_NUMBER=$1  # コマンドライン引数から取得
if [ -z "$ISSUE_NUMBER" ]; then
    echo "Usage: $0 <issue_number>"
    exit 1
fi

gh issue view $ISSUE_NUMBER
```

#### **説明用記述（非実行）**
```bash
# Issue対応の基本フロー（概念説明）
# 1. Issue番号の取得
ISSUE_NUMBER="123"  # 例: Issue #123の場合

# 2. Issue内容の確認
gh issue view $ISSUE_NUMBER

# 3. ブランチ作成
git checkout -b fix/issue-$ISSUE_NUMBER
```

この指針により、Claude Codeの誤実行やフリーズを防ぎながら、わかりやすいドキュメントを維持できます。